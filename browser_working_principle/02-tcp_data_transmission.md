
![图片](https://user-images.githubusercontent.com/31262456/145204500-5c043b6c-0de4-4231-a6c2-0c9f418b9ebc.png)

把数据包从主机A发送到主机B
#### 1、IP协议的处理：
作用于网络层

网络层会把ip头（附带主机A、B的ip信息的数据结构，包含 IP 版本、源 IP 地址、目标 IP 地址、生存时间等）附加到数据包上，与数据部分组合成新的数据包传输给主机B。主机B网络层拆开IP头信息

#### 2、UDP（用户数据包协议）：把数据包送达应用程序
作用于传输层

IP 通过 IP 地址信息把数据包发送给指定的电脑，而 UDP 通过**端口号**把数据包分发给正确的程序

- 在传输层 UDP头（目的端口、源端口号等）与原始数据包组成新的UDP数据包。交给网络层
- 网络层附加IP头组成新的数据包
- 。。。
- 在主机B传输层，UDP头拆开，根据端口号把数据部分交给应用程序。
- 
UDP传输速度快，但不保证数据可靠性，可以校验数据但不提供重发机制，丢弃错误数据包。

#### 3. TCP(传输控制协议)：把数据完整地送达应用程序
面向连接的、可靠的、基于字节流的传输层通信协议

相对于 UDP，TCP 有下面两个特点:
- 对于数据包丢失的情况，TCP提供重传机制，牺牲了传输速度；
- TCP 引入了数据包排序机制，用来保证把乱序的数据包组合成一个完整的文件。(大文件被拆分成很多小的数据包传输，UDP不知道如何组装还原)

TCP 头包含了目标端口和本机端口号外，还提供了用于排序的序列号，也用于丢包重发
![图片](https://user-images.githubusercontent.com/31262456/145204407-e4eead1f-6fca-4e59-8c0c-88363812e5ab.png)

一个完整的 TCP 连接的生命周期包括了“建立连接”“传输数据”和“断开连接”三个阶段
![图片](https://user-images.githubusercontent.com/31262456/145204365-83bd6814-b8f4-401b-b92d-4ea3b4188f98.png)

建立一个连接需要三次握手，而终止一个连接要经过四次握手，这是由TCP的半关闭（half-close）造成的。

1. 某端应用进程调用close（执行主动关闭）， 该端TCP发送一个FIN字节，表示数据发送完毕，要关闭连接。
2. 收到FIN（也作为文件结束符）执行被动关闭，由TCP确认后发出ACK
3. 一段时间后，收到FIN的进程调用close关闭它的套接字，导致它的TCP也发送一个FIN
4. 执行主动关闭的一端确认FIN，发送ACK。
![图片](https://user-images.githubusercontent.com/31262456/145204313-26ee55ac-d9fe-4d36-8313-2586e6243696.png)

每个方向都需要一个FIN和一个ACK，因此通常需要4个分节。2/3有可能被合并成一个分节

无论是客户还是服务器，任何一端都可以执行主动关闭。通常情况是，客户执行主动关闭，但是某些协议，例如，HTTP/1.0却由服务器执行主动关闭。
在流量控制上，采用滑动窗口协议，协议中规定，对于窗口内未经确认的分组需要重传。

无论是客户还是服务器，任何一端都可以执行主动关闭。通常情况是，客户执行主动关闭，但是某些协议，例如，HTTP/1.0却由服务器执行主动关闭。


##### 套接字socket 
对网络中不同主机上的应用进程之间进行双向通信的端点的抽象(逻辑上的概念)。完成两个应用程序之间的数据传输

一个套接字就是网络上进程通信的一端，提供了应用层进程利用网络协议交换数据的机制。套接字上联应用进程，下联网络协议栈

`
套接字Socket=（IP地址：端口号）
`